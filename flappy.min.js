function FlappyBird(e,t){const n={total:10,step:300,innerColumn:170,backgroundImage:null,debug:!1,...t},a=document.getElementById(e);if(n.debug&&(console.log("Debug mode enabled"),console.table(n)),!a)throw new Error("Element with id "+e+" not found");let l=n.total;const p={flappy:null,flappyAnimation:null,flappyCount:null,flappyLine:null,flappyContainer:a,flappyColumns:null};let i=[];const o=[];let s=0;const d={columns:null,flappy:null};l<a.offsetWidth/n.step&&(l=a.offsetWidth/n.step+1);const f=["flappy","flappy-b","flappy-g"],r=f[Math.floor(Math.random()*f.length)];function c(){p.flappy=document.createElement("div"),p.flappyAnimation=document.createElement("div"),p.flappy.classList.add("flappy"),p.flappyAnimation.classList.add("flappy-animation"),p.flappyAnimation.style.backgroundImage="url(./assets/"+r+".gif)",p.flappy.appendChild(p.flappyAnimation),p.flappyContainer.innerHTML="",p.flappyCount=document.createElement("span"),p.flappyCount.classList.add("flappy-counts"),n.debug&&p.flappyContainer.classList.add("debug"),p.flappyCount.textContent=0,p.flappyLine=document.createElement("div"),p.flappyContainer.appendChild(p.flappyCount),p.flappyContainer.appendChild(p.flappy),p.flappyContainer.appendChild(p.flappyLine),p.flappyLine.classList.add("flappy-line"),p.flappyLine.style.width=p.flappyContainer.width+"px",function(e){i=[],p.flappyColumns=document.createElement("div"),p.flappyColumns.classList.add("flappy-columns"),p.flappyColumns.style.left=p.flappyContainer.offsetWidth+"px",p.flappyContainer.appendChild(p.flappyColumns);for(let t=0;t<e;t++)y(n.step*t,t)}(l)}function y(e,t){const a=document.createElement("div"),l=document.createElement("div"),o=document.createElement("div");a.classList.add("flappy-column"),a.setAttribute("data-index",t),a.style.height=p.flappyContainer.offsetHeight+n.innerColumn+"px",a.style.marginLeft=e+"px",a.style.top=Math.floor(Math.random()*-n.innerColumn)+"px",l.classList.add("flappy-up-column"),o.classList.add("flappy-down-column"),l.style.height=p.flappyContainer.offsetHeight/2+"px",o.style.height=p.flappyContainer.offsetHeight/2+"px",a.appendChild(l),a.appendChild(o),i.push(a),p.flappyColumns.appendChild(a)}function u(e,t){const n=e.getBoundingClientRect(),a=t.getBoundingClientRect();return!(n.right<a.left)&&(!(n.left>a.right)&&(!(n.bottom<a.top)&&n.top<=a.bottom))}function m(){if(!i.length)return;h();const e=p.flappy.getBoundingClientRect().x,t=i[0].getBoundingClientRect().x+i[0].getBoundingClientRect().width,a=i[0].getAttribute("data-index");if(!(e<t))return n.debug?(i[0].classList.contains("debug_hit")?p.flappyCount.textContent=parseInt(p.flappyCount.textContent)-1:(i[0].classList.add("debug_pass"),p.flappyCount.textContent=parseInt(p.flappyCount.textContent)+1),console.log("change score: "+p.flappyCount.textContent)):p.flappyCount.textContent=parseInt(p.flappyCount.textContent)+1,void i.splice(0,1);if(u(p.flappy,i[0])){if(u(p.flappy,i[0].children[0])){if(!n.debug)return void g();i[0].classList.add("debug_hit"),i[0].children[0].classList.add("debug_collide"),console.warn("collide with down column, index: "+a)}if(u(p.flappy,i[0].children[1])){if(!n.debug)return void g();i[0].classList.add("debug_hit"),i[0].children[1].classList.add("debug_collide"),console.warn("collide with up column, index: "+a)}}if(p.flappyColumns.children[0].getBoundingClientRect().x<-p.flappyColumns.children[0].getBoundingClientRect().width){const e=p.flappyColumns.children[0].getAttribute("data-index");p.flappyColumns.children[0].remove();const t=p.flappyColumns.children[p.flappyColumns.children.length-1].style.marginLeft;y(parseInt(t)+n.step,e)}}function h(){p.flappy.offsetTop+p.flappy.offsetWidth>=p.flappyContainer.offsetHeight-p.flappyLine.offsetHeight&&g(),p.flappy.offsetTop<=0-p.flappy.offsetWidth&&g()}function C(){c();const e=document.createElement("div");e.classList.add("flappy-play"),e.innerHTML='\n            <div class="flappy-back-main">\n                <div class="flappy-text">\n                    <h2>Flappy Bird</h2>\n                </div>\n                <div class="flappy-click"></div>\n            </div>\n        ',function(e,t=200,n){e.style.opacity="0";e.animate([{opacity:0},{opacity:1}],{duration:t,fill:"forwards"}).finished.then(n)}(e,200,(()=>{})),e.setAttribute("tabindex","0"),p.flappyLine.style.animationPlayState="running",p.flappyContainer.appendChild(e),p.flappy.style.top=void 0,e.focus(),e.addEventListener("keydown",(t=>{38!==t.keyCode&&87!==t.keyCode&&32!==t.keyCode||(w(),b(e,150,(()=>e.remove())),p.flappyContainer.setAttribute("tabindex","0"),p.flappyContainer.focus())})),e.addEventListener("click",(()=>{w(),e.remove(),p.flappyContainer.setAttribute("tabindex","0"),p.flappyContainer.focus(),b(e,150,(()=>e.remove()))}))}function g(){d.columns.pause(),p.flappyLine.style.animationPlayState="paused",p.flappyAnimation.style.backgroundImage="url(./assets/"+r+"-dead.png)",p.flappyContainer.removeEventListener("mousedown",E),p.flappyContainer.removeEventListener("keydown",k),p.flappyContainer.removeEventListener("click",E),clearInterval(s);const e=parseInt(p.flappyCount.textContent)||0;o.push(e);const t=Math.max(...o);p.flappyCount.style.display="none",function(e,t){const n=function(e){let t="";return e<10?(t="medal-no",t):e>=10&&e<30?(t="medal-silver",t):e>=30&&e<50?(t="medal-bronze",t):e>=50&&e<75?(t="medal-gold",t):e>=75?(t="medal-ultimate",t):void 0}(e),a=document.createElement("div"),l=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div"),d=document.createElement("div"),f=document.createElement("a");let r=document.createElement("b");a.classList.add("flappy-play"),l.classList.add("flappy-back-result"),i.classList.add("flappy-result-text"),o.classList.add("flappy-result-back"),s.classList.add("flappy-buttons"),d.classList.add("flappy-restart"),f.classList.add("flappy-rate"),i.style.opacity=0,o.style.opacity=0,s.style.opacity=0,i.style.marginTop="-40px",o.style.marginTop="60px",f.href="https://twitter.com/troshkin_pavel",e>=t&&e>0&&(r=document.createElement("b"),r.innerHTML="new"),i.innerHTML="<h1>Game Over</h1>",o.innerHTML=`\n            <div class=flappy-result-medal>\n                 <p>Medal</p>\n                 <img src="./assets/${n}.png" alt="Medal" />\n            </div>\n            <div class=flappy-results>\n                <p>score</p>\n                <h2>${e}</h2>\n                <p class="flappy-best-result">\n                   ${e>=t&&e>0?r.outerHTML:""}\n                   best\n                </p>\n                <h2>${t}</h2>\n            </div>\n        `,s.appendChild(d),s.appendChild(f),l.appendChild(i),l.appendChild(o),l.appendChild(s),a.appendChild(l),p.flappyContainer.appendChild(a),a.animate([{backgroundColor:"transparent"},{backgroundColor:"rgba(255,255,255,.5)"},{backgroundColor:"transparent"}],{duration:100,fill:"forwards"}),i.animate([{opacity:0,marginTop:"-40px"},{opacity:1,marginTop:"0px"}],{duration:200,fill:"forwards"}),o.animate([{opacity:0,marginTop:"60px"},{opacity:1,marginTop:"20px"}],{duration:200,fill:"forwards",delay:200}),s.animate({opacity:1},{duration:200,fill:"forwards",delay:400}),d.tabIndex=0,d.focus(),d.addEventListener("keydown",(e=>{13===e.keyCode&&(a.remove(),C())})),d.addEventListener("click",(()=>{a.remove(),C()}))}(e,t)}function v(e,t){d.flappy&&(d.flappy.pause(),p.flappy.getAnimations().forEach((e=>{"falling"===e.id&&e.cancel()})));const n=t<0?0:t,a=new KeyframeEffect(p.flappy,{top:e+"px"},{id:"falling",duration:n,fill:"forwards",easing:"cubic-bezier(0.825, 0.620, 1.000, 0.815)"});d.flappy=new Animation(a,document.timeline),d.flappy.play()}function L(e=70,t=120){d.flappy.pause();const n=new KeyframeEffect(p.flappy,{top:p.flappy.offsetTop-e+"px"},{duration:t,fill:"forwards"}),a=new Animation(n,document.timeline);a.finished.then((()=>{d.flappy.play(),function(){p.flappyAnimation.classList.remove("flappy-up"),p.flappyAnimation.classList.contains("flappy-down")||p.flappyAnimation.classList.add("flappy-down");const e=p.flappy.offsetTop+(p.flappy.offsetHeight+p.flappyLine.offsetHeight),t=2.8*(p.flappyContainer.offsetHeight-p.flappyLine.offsetHeight-e);v(p.flappyContainer.offsetHeight-(p.flappy.offsetHeight+p.flappyLine.offsetHeight),t)}()})),a.play()}function b(e,t=200,n){e.style.opacity="1";e.animate([{opacity:1},{opacity:0}],{duration:t,fill:"forwards"}).finished.then(n)}function w(){!function(e){const t=new KeyframeEffect(p.flappyColumns,{left:400*-(e+40)+"px"},{duration:1635*(e+40),easing:"linear"});d.columns=new Animation(t,document.timeline),d.columns.finished.then(g),d.columns.play()}(l),function(e=20){clearInterval(s),m(),h(),s=setInterval(m,e)}(),p.flappyAnimation.classList.add("flappy-down"),p.flappy.style.animationPlayState="paused";v(p.flappyContainer.offsetHeight-(p.flappy.offsetHeight+p.flappyLine.offsetHeight)-11,1e3),p.flappyContainer.addEventListener("mousedown",E),p.flappyContainer.addEventListener("keydown",k)}!function(e,t){let n;const a=["city","space","sea","cemetery","swamp","sea-sunset","sea-night"];n=a.includes(t.backgroundImage)?t.backgroundImage:a[Math.floor(Math.random()*a.length)];e.style.background=`transparent url(./assets/background-${n}.png) 0 0 no-repeat`,e.style.backgroundSize="cover",e.style.overflow="hidden",e.style.cursor="pointer",e.style.userSelect="none"}(a,n),window.addEventListener("resize",(()=>location.reload()));const x=()=>{p.flappyAnimation.classList.add("flappy-up"),p.flappyAnimation.classList.remove("flappy-down"),L()};function E(e){e.preventDefault(),x()}function k(e){e.preventDefault(),38!==e.keyCode&&87!==e.keyCode&&32!==e.keyCode||x()}C()}
